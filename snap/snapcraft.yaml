name: cytopia
summary: Cytopia is a free, open source retro pixel-art city building game
description: |
  Cytopia is a free, open source retro pixel-art city building game with a big 
  focus on mods. It utilizes a custom isometric rendering engine based on SDL2.
adopt-info: cytopia
base: core24
license: GPL-3.0
confinement: strict
compression: lzo
source-code: https://github.com/CytopiaTeam/Cytopia
issues: https://github.com/kz6fittycent/Cytopia/issues
contact: https://github.com/kz6fittycent/Cytopia
icon: snap/local/cytopia.png

platforms:
  amd64:
    build-on: [amd64]
    build-for: [amd64]
    
apps:
  cytopia:
    command: usr/bin/cytopia
    extensions: [gnome]
    after: 
      - conan
      - libnoise
    plugs:
      - home
      - network
      - joystick
      - opengl
      - audio-playback     

parts:
  cytopia:
    source: https://github.com/CytopiaTeam/Cytopia
    source-type: git
    plugin: cmake
    cmake-parameters:
      - -DCMAKE_INSTALL_PREFIX=/usr
      - -DCMAKE_PREFIX_PATH=$CRAFT_STAGE/usr
    build-packages:
      - libopenal-dev
      - zlib1g-dev
#      - libnoise0
      - libvorbis-dev
      - libpng-dev
      - libimgui-dev
      - python3
      - libfreetype-dev
      - libsdl2-image-dev
      - libsdl2-dev
      - libsdl2-ttf-dev
      - angelscript-dev
      - libmicroprofile-dev
      - libmicroprofile4
      - doxygen
      - pkg-config
    after:
      - conan
      - libnoise
      
    override-pull: |
      craftctl default
      craftctl set version="$(git describe --tags | sed 's/^v//' | cut -d "-" -f1)"  
        
  conan:
    plugin: dump
    source: https://github.com/conan-io/conan/releases/download/2.10.1/conan-2.10.1-amd64.deb
    source-type: deb
    
  libnoise:
    plugin: cmake
    source: https://github.com/eXpl0it3r/libnoise
    source-type: git
